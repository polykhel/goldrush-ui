<section
  class="card container mx-auto max-w-5xl p-8 rounded-lg shadow-lg hover:shadow-xl border border-gray-100">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <form [formGroup]="bookingForm" class="max-w-5xl mx-auto">
    <div class="flex justify-between align-items-center mb-3">
      <p-button (click)="goBack()" [text]="true" icon="pi pi-arrow-left" label="Back"></p-button>
      <h2 class="font-bold">{{ bookingId ? 'Edit' : 'New' }} Booking</h2>
    </div>

    <!-- Basic Information Section -->
    <section class="mb-8">
      <h3 class="font-bold mb-4 border-b pb-2">Basic Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <p-float-label variant="on">
          <p-date-picker id="bookingDate" formControlName="bookingDate" [showIcon]="true" dateFormat="mm-dd-yy"></p-date-picker>
          <label for="bookingDate">Booking Date</label>
        </p-float-label>

        <p-float-label variant="on">
          <p-select id="status" formControlName="status" [options]="statusOptions" optionLabel="label" optionValue="value"></p-select>
          <label for="status">Status</label>
        </p-float-label>
      </div>

      <div class="mt-4">
        <p-float-label variant="on">
          <input class="w-full" formControlName="clientName" id="clientName" pInputText type="text">
          <label for="clientName">Client Name</label>
        </p-float-label>
      </div>
    </section>

    <!-- Travel Details Section -->
    <section class="mb-8">
      <h3 class="font-bold mb-4 border-b pb-2">Travel Details</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <p-float-label variant="on">
          <p-date-picker id="travelStartDate" formControlName="travelStartDate" [showIcon]="true" dateFormat="mm-dd-yy"></p-date-picker>
          <label for="travelStartDate">Travel Start Date</label>
        </p-float-label>

        <p-float-label variant="on">
          <p-date-picker id="travelEndDate" formControlName="travelEndDate" [showIcon]="true" dateFormat="mm-dd-yy"></p-date-picker>
          <label for="travelEndDate">Travel End Date</label>
        </p-float-label>

        <p-float-label variant="on">
          <input class="w-full" formControlName="destination" id="destination" pInputText type="text">
          <label for="destination">Destination</label>
        </p-float-label>

        <div class="grid grid-cols-2 gap-2">
          <div class="flex flex-col gap-2">
            <div class="flex items-center gap-2">
              <p-radio-button formControlName="packageType" inputId="allInclusive"
                              value="ALL_INCLUSIVE"/>
              <label for="allInclusive">All-Inclusive Package</label>
            </div>
            <div class="flex items-center gap-2">
              <p-radio-button formControlName="packageType" inputId="custom" value="CUSTOM"/>
              <label for="custom">Custom Package</label>
            </div>
          </div>
            @if (bookingForm.controls['packageType'].value === 'CUSTOM') {
              <div class="flex flex-col gap-2">
              <div
                class="ml-6 flex flex-col gap-2">
                @for (option of packageOptions; track option) {
                  <div class="flex items-center gap-2">
                    <p-checkbox
                      [formControlName]="'customPackageOptions'"
                      [inputId]="option.id"
                      [value]="option.id">
                    </p-checkbox>
                    <label [for]="option.id" class="ml-2"> {{ option.label }} </label>
                  </div>
                }
              </div>
              </div>
            }
        </div>
      </div>
    </section>

    <!-- Payment Details Section -->
    <section class="mb-8">
      <h3 class="font-bold mb-4 border-b pb-2">Payment Details</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <p-float-label variant="on">
          <p-inputNumber id="totalAmount" formControlName="totalAmount" mode="currency" currency="PHP" locale="en-US" (onBlur)="calculateRemainingAmount()"></p-inputNumber>
          <label for="totalAmount">Total Amount</label>
        </p-float-label>

        <p-float-label variant="on">
          <p-inputNumber id="paidAmount" formControlName="paidAmount" mode="currency" currency="PHP" locale="en-US" (onBlur)="calculateRemainingAmount()"></p-inputNumber>
          <label for="paidAmount">Paid Amount</label>
        </p-float-label>

        <p-float-label variant="on">
          <p-inputNumber id="remainingAmount" formControlName="remainingAmount" mode="currency" currency="PHP" locale="en-US" [readonly]="true"></p-inputNumber>
          <label for="remainingAmount">Remaining Amount</label>
        </p-float-label>
      </div>
    </section>

    <!-- Additional Information Section -->
    <section class="mb-8">
      <h3 class="font-bold mb-4 border-b pb-2">Additional Information</h3>
      <div class="grid grid-cols-1 gap-4">
        <p-float-label variant="on">
          <textarea pTextarea id="remarks" formControlName="remarks" rows="3" class="w-full"></textarea>
          <label for="remarks">Remarks</label>
        </p-float-label>
      </div>
    </section>

    <!-- Actions Section -->
    <section class="mb-4">
      <div class="flex justify-end gap-2">
        <p-button label="Save" icon="pi pi-save" (onClick)="updateRemarks()" [disabled]="bookingForm.invalid || loading"></p-button>
      </div>
    </section>
  </form>

  <!-- Side Actions Panel -->
  <div class="mt-8 p-4 border rounded-lg bg-gray-50" *ngIf="bookingId">
    <h3 class="font-bold mb-4 border-b pb-2">Actions</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <h4 class="font-semibold mb-2">Documents</h4>
        <p-button label="Generate Statement of Account" icon="pi pi-file-pdf" styleClass="p-button-info w-full mb-2"
          (onClick)="generateStatementOfAccount()" [disabled]="loading"></p-button>

        <div *ngIf="bookingForm.get('statementOfAccountUrl')?.value" class="mb-3">
          <a [href]="bookingForm.get('statementOfAccountUrl')?.value" target="_blank" class="text-primary flex items-center">
            <i class="pi pi-external-link mr-1"></i>View Statement of Account
          </a>
        </div>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Payment Status</h4>
        <div class="flex flex-column gap-2">
          <p-button label="Mark as Partially Paid" icon="pi pi-wallet" styleClass="p-button-warning w-full mb-2"
            (onClick)="updateStatus(statusOptions[1].value)" [disabled]="loading || bookingForm.get('status')?.value === statusOptions[1].value"></p-button>

          <p-button label="Mark as Fully Paid" icon="pi pi-check-circle" styleClass="p-button-success w-full mb-2"
            (onClick)="updateStatus(statusOptions[2].value)" [disabled]="loading || bookingForm.get('status')?.value === statusOptions[2].value"></p-button>

          <p-button label="Update Payment" icon="pi pi-money-bill" styleClass="p-button-primary w-full"
            (onClick)="updatePayment()" [disabled]="loading"></p-button>
        </div>
      </div>
    </div>
  </div>
</section>
